<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Erzbergrodeo Speaker Dashboard</title>
    <style>
      body {
        font-family: sans-serif;
        background: #f7f7f7;
        margin: 0;
        padding: 20px;
      }
      h1 {
        font-size: 24px;
        margin-bottom: 10px;
      }
      table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 30px;
  font-family: sans-serif;
  font-size: 14px;
}

.table-container {
  max-height: calc(10 * 41px);
  overflow-y: auto;

  /* Hide scrollbar (cross-browser) */
  scrollbar-width: none; /* Firefox */
  -ms-overflow-style: none;  /* IE and Edge */
}

.table-container::-webkit-scrollbar {
  display: none;  /* Chrome, Safari, Opera */
}

#leaderboard {
  margin: auto;
  width: 90%;
}


th,
td {
  padding: 10px 14px;
  border-bottom: 1px solid #e5e7eb;
  text-align: left;
}

th {
  background: #222;
  color: white;
  position: sticky;
  top: 0;
  z-index: 1;
}

/* Zebra striping */
tbody tr:nth-child(odd) {
  background-color: #f9fafb;
}

tbody tr:nth-child(even) {
  background-color: #ffffff;
}

/* Hover effect */
tbody tr:hover {
  background-color: #f3f4f6;
}

/* Highlighted row */
.highlight {
  background: #d1fae5 !important;
}


      .cp-table td {
        text-align: center;
      }

      .badge {
        font-size: 1em;
        background: #4ade80;
        color: #222;
        font-weight: bold;
        padding: 2px 6px;
        border-radius: 4px;
      }

.responsive-cp {
  max-width: 100%;
  padding: 0 10px;
}

.responsive-cp-grid-wrapper {
  display: flex;
  justify-content: center;
}

.responsive-cp-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
  max-width: calc(70px * 10 + 9 * 10px); /* 10 items + 9 gaps */
  width: 100%;
  gap: 10px;
}

      .cp-item {
        background: white;
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 3px;
        text-align: center;
        font-size: 1em;
      }

      .cp-label {
        font-weight: bold;
        font-size: 1em;
        color: #f7f7f7;
        background-color: #111;
        padding-top: 3px;
      }

      .cp-value {
        margin-top: 4px;
        font-size: 1.3em;
        color: #111;
      }

      .progress-wrapper {
  background: #e5e7eb;
  border-radius: 4px;
  position: relative;
  height: 18px;
  width: 100%;
  max-width: 300px;
  overflow: hidden;
}

.progress-bar {
  background: #4ade80;
  height: 100%;
  transition: width 0.3s ease;
}

.progress-label {
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  font-size: 11px;
  line-height: 16px;
  color: #111;
  font-weight: bold;
}
    </style>
  </head>
  <body>
    <h1>üèÅ Erzbergrodeo Dashboard</h1>

    <section>
      <h2 style="text-align: center;">Top 20 Riders (by total time)</h2>
      <div class="table-container">
        <table id="leaderboard">
          <thead>
            <tr>
              <th>Pos</th>
              <th>Bib</th>
              <th>Name</th>
              <th>Time</th>
              <th>Progress</th>
              <th>Current CP</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section>
      <h2 style="text-align: center;">Checkpoint Counts</h2>
      <div class="responsive-cp" style="margin-left: auto; margin-right: auto; width: fit-content;">
  <div class="responsive-cp-grid-wrapper">
    <div class="responsive-cp-grid" id="checkpointStatsGrid">
      <!-- JavaScript will populate this -->
    </div>
  </div>
</div>
    </section>

    <script>
      const API_URL =
        "https://api.raceresult.com/292775/MRZHEBCS0R2X3WGCZLWHDFS46SLBA7FD";

      async function fetchData() {
        const res = await fetch(API_URL);
        const data = await res.json();
        return data;
      }

      function dToMs(t) {
        const parts = t.split(":");
        if (parts.length < 3) return Infinity;
        const [h, m, s] = parts;
        return +h * 3600 + +m * 60 + parseFloat(s.replace(",", "."));
      }

      function updateLeaderboard(data) {
        const tbody = document.querySelector("#leaderboard tbody");
        tbody.innerHTML = "";

        data.forEach((r) => {
          r.lastCPNum = 0;
          for (let i = 27; i >= 1; i--) {
            if (r["CP" + i]) {
              r.lastCPNum = i;
              break;
            }
          }
        });

        const getBarColor = (percent) => {
  if (percent >= 100) return '#22c55e'; // green-500 ‚Üí ‚úÖ "complete"
  if (percent >= 80)  return '#84cc16'; // lime-500 ‚Üí strong greenish-yellow
  if (percent >= 60)  return '#facc15'; // yellow-400 ‚Üí ‚ö†Ô∏è "decent progress"
  if (percent >= 40)  return '#fb923c'; // orange-400 ‚Üí üü† "halfway"
  if (percent >= 20)  return '#f87171'; // red-400 ‚Üí üî¥ "early"
  return '#ef4444';                     // red-500 ‚Üí ‚ùó "just started"
};

        const sorted = data
          .filter((r) => r.lastCPNum > 0)
          .sort((a, b) => {
            if (b.lastCPNum !== a.lastCPNum) return b.lastCPNum - a.lastCPNum;
            return dToMs(a.ERZ_Time) - dToMs(b.ERZ_Time);
          })
          .slice(0, 50);

        sorted.forEach((r, i) => {
          const tr = document.createElement("tr");
          const percent = Math.round((r.lastCPNum / 27) * 100);
          tr.innerHTML = `
  <td>${i + 1}</td>
  <td>${r.ERZ_Number}</td>
  <td>${r.DisplayNameERZ}</td>
  <td>${r.ERZ_Time || "-"}</td>
  <td>
    <div class="progress-wrapper">
      <div class="progress-bar" style="width: ${percent}%; background: ${getBarColor(percent)};"></div>
      <div class="progress-label">${percent}%</div>
    </div>
  </td>
  <td><span class="badge">CP${r.lastCPNum}</span> - ${r.CheckpointName}</td>
`;
          tbody.appendChild(tr);
        });
      }

      function updateCheckpointStats(data) {
        const container = document.getElementById("checkpointStatsGrid");
        container.innerHTML = "";

        const counts = Array(27).fill(0);
        data.forEach((r) => {
          for (let i = 1; i <= 27; i++) {
            if (r["CP" + i]) counts[i - 1]++;
          }
        });

        for (let i = 1; i <= 27; i++) {
          const div = document.createElement("div");
          div.className = "cp-item";
          div.innerHTML = `
            <div class="cp-label">CP${i}</div>
            <div class="cp-value">${counts[i - 1]}</div>
          `;
          container.appendChild(div);
        }
      }

      async function loadDashboard() {
        const data = await fetchData();
        updateLeaderboard(data);
        updateCheckpointStats(data);
      }

      loadDashboard();
      setInterval(loadDashboard, 3000);
    </script>
  </body>
</html>
